@using Kendo.Mvc.UI

<h3>@ViewBag.Title</h3>
@RenderPage("../Shared/_DashboardMenu.cshtml")
<div id="toolbar" class="row">
</div>
<div class="row">
    <div class="col-lg-12">
        @(Html.Kendo().Grid<MVC_BathCompareSIte.DTO.UserDTO>()
              .Name("user_grid")
              .Columns(col =>
              {
                  col.Bound(p => p.Email).Width(100);
                  col.Bound(p => p.Firstname).Width(100);
                  col.Bound(p => p.Lastname).Width(100);
                  col.Bound(p => p.Address).Width(100);
                  col.Bound(p => p.Expired).Width(100);
                  col.Command(cmd =>
                  {
                      cmd.Edit();
                      cmd.Destroy();
                  }).Width(160);
              })
              //.ToolBar(toolbar => toolbar.Create())
              .Editable(editable => editable.Mode(GridEditMode.PopUp).TemplateName("PopupUser"))
              .Pageable()
              .Sortable()
              .Scrollable(scrol => scrol.Height(400))
              .DataSource(ds => ds
                  .Ajax()
                  .PageSize(10)
                  .Events(events => events.Error("error_handler"))
                  .Model(model => model.Id(p => p.UserId))
                  .Read(read => read.Action("SearchUsers", "Admin"))
                  //.Create(create => create.Action("AddUser", "Admin"))
                  .Update(update => update.Action("UpdateUser", "Admin"))
                  .Destroy(del => del.Action("DeleteUser", "Admin"))
              )
              )
    </div>
    <button id="testModal">Test</button>
    <div id="errorModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title text-danger">Error</h4>
                </div>
                <div class="modal-body">
                    <p id="errorMessage">&nbsp;</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    @*<button type="button" class="btn btn-primary">Save changes</button>*@
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>

<!--Scripts-->
<script type="text/javascript">
    function error_handler(e) {
        if (e.errors) {
            var message = "";
            $.each(e.errors, function (key, value) {
                if ('errors' in value) {
                    $.each(value.errors, function () {
                        message += this + "\n";
                    });
                }
            });

            $("#errorMessage").text(message);
            $("#errorModal").modal('show');
        }
    }
</script>
